<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesture AI Agent - Control Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body class="bg-dark text-light">
    <nav class="navbar navbar-dark bg-darker border-bottom border-secondary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-hand-thumbs-up"></i> Gesture AI Agent Dashboard
            </span>
            <div class="d-flex align-items-center">
                <span id="healthStatus" class="badge bg-success me-2">
                    <i class="bi bi-circle-fill"></i> Connected
                </span>
                <span id="systemTime" class="text-secondary small"></span>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <!-- Control Panel -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-darker border-secondary h-100">
                    <div class="card-body">
                        <h5 class="card-title mb-4">
                            <i class="bi bi-gear"></i> System Control
                        </h5>
                        <div class="d-grid gap-2">
                            <button id="btnStart" class="btn btn-success btn-lg" onclick="startAgent()">
                                <i class="bi bi-play-fill"></i> Start Agent
                            </button>
                            <button id="btnStop" class="btn btn-danger btn-lg" onclick="stopAgent()" disabled>
                                <i class="bi bi-stop-fill"></i> Stop Agent
                            </button>
                            <button id="btnVoice" class="btn btn-warning btn-lg" onclick="toggleVoice()" title="Microphone may not be available">
                                <i class="bi bi-mic"></i> <span id="btnVoiceText">Enable Voice</span>
                            </button>
                            <button id="btnAutoScreenshot" class="btn btn-secondary btn-sm" onclick="toggleAutoScreenshot()">
                                <i class="bi bi-camera-fill"></i> Auto Screenshot
                            </button>
                        </div>
                        <div class="mt-4 p-3 bg-secondary bg-opacity-10 rounded">
                            <h6>Status</h6>
                            <div id="statusIndicators">
                                <div class="status-item">
                                    <span class="badge bg-info">Agent: <span id="agentStatus">Stopped</span></span>
                                </div>
                                <div class="status-item">
                                    <span class="badge bg-info">Frames: <span id="frameCount">0</span></span>
                                </div>
                                <div class="status-item">
                                    <span class="badge bg-info">Voice: <span id="voiceStatus">Disabled</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Camera Feed -->
            <div class="col-md-6">
                <div class="card bg-darker border-secondary h-100">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="bi bi-camera-video"></i> Live Camera Feed
                        </h5>
                        <div class="video-container position-relative">
                            <img id="videoFeed" alt="Camera Feed" class="img-fluid rounded border border-secondary" style="width: 100%; height: auto; background-color: #000;">
                            <div class="video-overlay">
                                <span id="streamStatus" class="badge bg-danger position-absolute top-0 end-0 m-2">
                                    <i class="bi bi-circle-fill"></i> Connecting...
                                </span>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button id="btnScreenshot" class="btn btn-info btn-sm w-100" onclick="takeScreenshot()">
                                <i class="bi bi-camera"></i> Take Screenshot
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real-time Detection Info -->
            <div class="col-md-3">
                <div class="card bg-darker border-secondary mb-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-hand-index"></i> Gesture Details
                        </h5>
                        <div class="detection-display">
                            <div class="gesture-label">
                                <span id="gestureType" class="badge bg-primary fs-5">None</span>
                            </div>
                            <div class="confidence-bar mt-2">
                                <small class="text-muted">Confidence</small>
                                <div class="progress" role="progressbar">
                                    <div id="gestureConfidence" class="progress-bar bg-info" style="width: 0%"></div>
                                </div>
                                <small id="gestureConfidenceText">0%</small>
                            </div>
                            <small class="text-muted mt-2 d-block">
                                <strong>Last Detected:</strong> <span id="gestureLastTime">—</span>
                            </small>
                            <small class="text-muted d-block">
                                <strong>Occurrences:</strong> <span id="gestureCount">0</span>
                            </small>
                        </div>
                    </div>
                </div>

                <div class="card bg-darker border-secondary mb-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-emoji-smile"></i> Emotion Details
                        </h5>
                        <div class="detection-display">
                            <div class="emotion-label">
                                <span id="emotionType" class="badge bg-warning fs-5">None</span>
                            </div>
                            <div class="confidence-bar mt-2">
                                <small class="text-muted">Confidence</small>
                                <div class="progress" role="progressbar">
                                    <div id="emotionConfidence" class="progress-bar bg-warning" style="width: 0%"></div>
                                </div>
                                <small id="emotionConfidenceText">0%</small>
                            </div>
                            <small class="text-muted mt-2 d-block">
                                <strong>Last Detected:</strong> <span id="emotionLastTime">—</span>
                            </small>
                        </div>
                    </div>
                </div>

                <div class="card bg-darker border-secondary">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-clock-history"></i> Last Action
                        </h5>
                        <div class="action-display">
                            <p id="lastAction" class="text-warning mb-1">—</p>
                            <small id="lastActionTime" class="text-muted">No actions yet</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics and History Tabs -->
        <div class="row">
            <div class="col-12">
                <div class="card bg-darker border-secondary">
                    <div class="card-body">
                        <ul class="nav nav-tabs nav-tabs-dark border-secondary mb-3" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link nav-link-dark active" id="statsTab" 
                                        data-bs-toggle="tab" data-bs-target="#statsPanel" type="button" role="tab">
                                    <i class="bi bi-bar-chart"></i> Statistics
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link nav-link-dark" id="historyTab" 
                                        data-bs-toggle="tab" data-bs-target="#historyPanel" type="button" role="tab">
                                    <i class="bi bi-list"></i> Gesture History
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link nav-link-dark" id="logsTab" 
                                        data-bs-toggle="tab" data-bs-target="#logsPanel" type="button" role="tab">
                                    <i class="bi bi-file-text"></i> Logs
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <!-- Statistics Panel -->
                            <div class="tab-pane fade show active" id="statsPanel" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="card bg-secondary bg-opacity-10 border-secondary">
                                            <div class="card-body">
                                                <h6 class="card-title text-muted">Total Gestures Detected</h6>
                                                <h3 id="totalGestures" class="text-success">0</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card bg-secondary bg-opacity-10 border-secondary">
                                            <div class="card-body">
                                                <h6 class="card-title text-muted">Average Confidence</h6>
                                                <h3 id="avgConfidence" class="text-info">0%</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card bg-secondary bg-opacity-10 border-secondary">
                                            <div class="card-body">
                                                <h6 class="card-title text-muted">Most Common</h6>
                                                <h3 id="mostCommon" class="text-warning">—</h3>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <h6>Gesture Breakdown</h6>
                                        <div id="gestureBreakdown" class="list-group list-group-flush">
                                            <p class="text-muted small">No data yet</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Gesture History Panel -->
                            <div class="tab-pane fade" id="historyPanel" role="tabpanel">
                                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                    <table class="table table-sm table-hover table-dark">
                                        <thead class="table-secondary">
                                            <tr>
                                                <th>Timestamp</th>
                                                <th>Gesture</th>
                                                <th>Confidence</th>
                                                <th>Details</th>
                                            </tr>
                                        </thead>
                                        <tbody id="gestureHistoryBody">
                                            <tr>
                                                <td colspan="4" class="text-center text-muted">No gesture history yet</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Comments/Notes Panel -->
                            <div class="tab-pane fade" id="commentsTab" role="tabpanel">
                                <div class="mb-3">
                                    <h6>Session Notes</h6>
                                    <textarea id="sessionNotes" class="form-control form-control-sm bg-secondary text-light" rows="4" placeholder="Add notes about detected gestures and emotions..."></textarea>
                                    <button class="btn btn-sm btn-primary mt-2" onclick="updateSessionNotes()">
                                        <i class="bi bi-save"></i> Save Notes
                                    </button>
                                </div>
                                <div class="mt-4">
                                    <h6>Gesture Summary</h6>
                                    <div id="gestureSummary" class="alert alert-secondary">
                                        <p class="text-muted small">Start the agent to capture gesture data...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Logs Panel -->
                            <div class="tab-pane fade" id="logsPanel" role="tabpanel">
                                <div class="alert alert-info mb-3">
                                    <i class="bi bi-info-circle"></i> 
                                    Check the console for detailed logs. This panel shows system events.
                                </div>
                                <div id="logsList" class="list-group list-group-flush" style="max-height: 300px; overflow-y: auto;">
                                    <p class="text-muted small p-2">No events yet</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-darker border-top border-secondary mt-5 py-3">
        <div class="container-fluid">
            <div class="row text-muted small">
                <div class="col-md-6">
                    <p>Gesture AI Agent v2.0.0</p>
                </div>
                <div class="col-md-6 text-end">
                    <p>Built with <i class="bi bi-heart-fill text-danger"></i> using Flask & Bootstrap</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
